---
title: "ã€Flutterã€‘ã¯ã˜ã‚ã¦ã®ML Kit"
emoji: "ğŸ’»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Flutter,AI,ML Kit,Dart]
published: true
---
# è¨˜äº‹ã®æ¦‚è¦
æœ¬è¨˜äº‹ã§ã¯ã€Flutterã§ML Kitã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®å¿…è¦æœ€ä½é™ã®çŸ¥è­˜ã«é–¢ã—ã¦è§£èª¬ã—ã€ä¾‹ã¨ã—ã¦é¡”æ¤œå‡ºãƒ¢ãƒ‡ãƒ«ã‚’åˆ©ç”¨ã—ãŸç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’å®Ÿè£…ã™ã‚‹ã€‚
å®Ÿè£…ã«ã¯Flutterã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚ã‚‹[google_ml_kit](#google_ml_kitã¨ã¯)ã‚’åˆ©ç”¨ã™ã‚‹ã€‚

# å‰æçŸ¥è­˜
## ML Kitã¨ã¯
### æ¦‚è¦
Googleã®æä¾›ã™ã‚‹ãƒ¢ãƒã‚¤ãƒ«SDKã§ã€ã™ã§ã«å­¦ç¿’æ¸ˆã¿ã®ãƒ¢ãƒ‡ãƒ«ã‚’iOS/Androidä¸Šã§ç°¡å˜ã«åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

### ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹/ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹
Googleã®æä¾›ã™ã‚‹AIã®ãƒ¢ãƒ‡ãƒ«ã«ã¯ã€ãƒ¢ãƒ‡ãƒ«ã‚’ç«¯æœ«ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦åˆ©ç”¨ã™ã‚‹**ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹ãƒ¢ãƒ‡ãƒ«**ã¨ã€ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®ãƒ¢ãƒ‡ãƒ«ã‚’APIçµŒç”±ã§åˆ©ç”¨ã™ã‚‹**ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«**ãŒã‚ã‚‹ã€‚ãã‚Œãã‚Œã®ç‰¹å¾´ã¯ä»¥ä¸‹ã§ã‚ã‚‹ã€‚
- ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹ãƒ¢ãƒ‡ãƒ«
ç«¯æœ«ã«ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§åˆ©ç”¨ã§ãã‚‹ã€‚
å…¨ã¦ç„¡æ–™ã§åˆ©ç”¨å¯èƒ½ã€‚
ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã«æ¯”ã¹ã¦ç²¾åº¦ãŒåŠ£ã‚‹ã€‚

- ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«
APIçµŒç”±ã§åˆ©ç”¨ã™ã‚‹ãŸã‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§åˆ©ç”¨ã§ãã‚‹ã€‚
åˆ©ç”¨çŠ¶æ³ã«ã‚ˆã£ã¦å¾“é‡èª²é‡‘åˆ¶ã®æ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹ã€‚
ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹ã‚ˆã‚Šã‚‚é«˜ç²¾åº¦ã€‚

Googleã§ã¯2020å¹´ã«ã€ã“ã®ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹ãƒ¢ãƒ‡ãƒ«ã¨ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’åŒºåˆ¥ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã®ã‚ˆã†ã«äºŒã¤ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«åˆ†å‰²ã—ã¦ã„ã‚‹ã€‚

- ML Kit
ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’å…¨ã¦å«ã‚€ã€‚
Flutterå‘ã‘ã«ã¯[google_ml_kit](#google_ml_kitã¨ã¯)ã¨ã„ã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒåˆ©ç”¨ã§ãã‚‹ã€‚

- Firebase ML
ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’å…¨ã¦å«ã‚€ã€‚

ãƒ¢ãƒ‡ãƒ«ã®ç¨®é¡ã«ã‚ˆã£ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹ã§ã—ã‹åˆ©ç”¨ã§ããªã„ã‚‚ã®ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã—ã‹åˆ©ç”¨ã§ããªã„ã‚‚ã®ã€ã©ã¡ã‚‰ã‹ã‚’é¸æŠã—ã¦åˆ©ç”¨ã§ãã‚‹ã‚‚ã®ãªã©ãŒã‚ã‚‹ã€‚

ä¾‹)
| ãƒ¢ãƒ‡ãƒ« | ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹ | ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ |
| ---- | ---- | ---- |
| ãƒ†ã‚­ã‚¹ãƒˆèªè­˜ | â—‹ |â—‹ |
| é¡”æ¤œå‡º | â—‹ | - |
| ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯èªè­˜ | - | â—‹ |

### ML KitãŒæä¾›ã™ã‚‹ãƒ¢ãƒ‡ãƒ«
ML Kitã§åˆ©ç”¨ã§ãã‚‹å­¦ç¿’æ¸ˆã¿ã®ãƒ¢ãƒ‡ãƒ«ã¯å¤§ããåˆ†ã‘ã¦Vision APIsã¨Natural Language APIsã«åˆ†ã‹ã‚Œã‚‹ã€‚
- Vision APIs
ç‰©ä½“æ¤œå‡ºã€ãƒ†ã‚­ã‚¹ãƒˆèªè­˜ã€é¡”æ¤œå‡ºãªã©ãŒå«ã¾ã‚Œã‚‹ã€‚
- Natural Language APIs
è¨€èªè­˜åˆ¥ã€ç¿»è¨³ã€ã‚¹ãƒãƒ¼ãƒˆãƒªãƒ—ãƒ©ã‚¤ãªã©ãŒå«ã¾ã‚Œã‚‹ã€‚

æœ€æ–°ã®ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã«é–¢ã—ã¦ã¯ã€[å…¬å¼ã‚¬ã‚¤ãƒ‰](https://developers.google.com/ml-kit/guides)ã‚’å‚ç…§ã€‚
ä¸Šè¿°ã®é€šã‚ŠML Kitã«å«ã¾ã‚Œã‚‹ãƒ¢ãƒ‡ãƒ«ã¯å…¨ã¦ã‚ªãƒ³ãƒ‡ãƒã‚¤ã‚¹ã§ã®å®Ÿè¡ŒãŒã§ãã€å…¨ã¦ç„¡æ–™ã§åˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹ã€‚

## google_ml_kitã¨ã¯
### æ¦‚è¦
ML Kitã‚’Flutterã§æ‰±ã†ãŸã‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚ã‚Šã€[google_ml_kit](https://pub.dev/packages/google_ml_kit)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§ã€ãƒ†ã‚­ã‚¹ãƒˆèªè­˜ã‚„é¡”æ¤œå‡ºã€ç¿»è¨³ãªã©ML Kitã«å«ã¾ã‚Œã‚‹å…¨ã¦ã®ãƒ¢ãƒ‡ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
https://pub.dev/packages/google_ml_kit

### æ³¨æ„ç‚¹
[google_ml_kit](https://pub.dev/packages/google_ml_kit)ã«ã¯å…¨ã¦ã®ãƒ¢ãƒ‡ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€ä¸è¦ãªãƒ¢ãƒ‡ãƒ«ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã—ã¾ã„ã‚¢ãƒ—ãƒªã®ã‚µã‚¤ã‚ºãŒç„¡é§„ã«è†¨ã‚‰ã‚“ã§ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚
ãã®ãŸã‚ã€ç‰¹å®šã®ãƒ¢ãƒ‡ãƒ«ã®ã¿ã‚’åˆ©ç”¨ã—ãŸã„å ´åˆã¯ã€[google_ml_kit](https://pub.dev/packages/google_ml_kit)ã®READMEã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ä¸­ã‹ã‚‰å¿…è¦ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã¿ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ãŒè‰¯ã„ã€‚
æœ¬è¨˜äº‹ã§ã¯ã€é¡”æ¤œå‡ºã®æ©Ÿèƒ½ã®ã¿å®Ÿè£…ã™ã‚‹ãŸã‚ã€[google_mlkit_face_detection](https://pub.dev/packages/google_mlkit_face_detection)ã‚’å˜ä½“ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

# é¡”æ¤œå‡ºã‚¢ãƒ—ãƒªå®Ÿè£…æ‰‹é †
å®Ÿéš›ã«ML Kitã‚’åˆ©ç”¨ã—ã¦ç°¡å˜ãªé¡”æ¤œå‡ºã‚¢ãƒ—ãƒªã‚’å®Ÿè£…ã™ã‚‹ã€‚
ä»Šå›å®Ÿè£…ã™ã‚‹ã‚¢ãƒ—ãƒªã§ã¯ã€ç«¯æœ«ã®å†™çœŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰ç”»åƒã‚’é¸æŠã—ã€ãã®å†™çœŸã‹ã‚‰æ¤œå‡ºã•ã‚ŒãŸé¡”ã®æ•°ã€æ¤œå‡ºã•ã‚ŒãŸé¡”ã®ç¬‘é¡”åº¦ã‚’è¡¨ç¤ºã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹ã€‚

**1. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
é¡”æ¤œå‡ºã®ãƒ¢ãƒ‡ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨å†™çœŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚
```dart:pubspec.yaml
google_mlkit_face_detection: ^0.5.0
image_picker: ^0.8.6
```

**2. å†™çœŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®è¨­å®šã‚’è¿½åŠ **
ios/Runner/Info.plistã«ä»¥ä¸‹ã®å€¤ã‚’è¿½åŠ ã™ã‚‹ã€‚
```dart:Info.plist
<key>NSPhotoLibraryUsageDescription</key>
<string>ã‚«ãƒ¡ãƒ©ã‚’ä½¿ã†ç†ç”±ãƒ»ç”¨é€”ã‚’è¨˜è¿°</string>
```

**3. main.dartã®å®Ÿè£…**
:::details main.dart
```dart:main.dart
import 'package:flutter/material.dart';
import 'face_detector_view.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      debugShowCheckedModeBanner: false,
      home: Home(),
    );
  }
}

class Home extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
        appBar: AppBar(
          title: const Text('Face Detector App'),
        ),
        // â‘ FaceDetectorViewã‚’ã‚»ãƒƒãƒˆ
        body: FaceDetectorView());
  }
}
```
:::
main.dartã§ã¯ã€å¾Œè¿°ã®FaceDetectorViewã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

**4. face_detector_view.dartã®å®Ÿè£…**
:::details face_detector_view.dart
```dart:face_detector_view.dart
import 'package:flutter/material.dart';
import 'package:google_mlkit_face_detection/google_mlkit_face_detection.dart';
import 'camera_view.dart';

class FaceDetectorView extends StatefulWidget {
  @override
  State<FaceDetectorView> createState() => _FaceDetectorViewState();
}

class _FaceDetectorViewState extends State<FaceDetectorView> {
  // â‘ FaceDetectorã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
  final FaceDetector _faceDetector = FaceDetector(
    options: FaceDetectorOptions(
      enableContours: true,
      enableClassification: true,
    ),
  );
  bool _canProcess = true;
  bool _isBusy = false;
  String? _text;

  @override
  void dispose() {
    _canProcess = false;
    _faceDetector.close();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return CameraView(
      text: _text,
      onImage: (inputImage) {
        processImage(inputImage);
      },
    );
  }

  // â‘¡é¡”æ¤œå‡ºå‡¦ç†ã®ãŸã‚ã®é–¢æ•°
  Future<void> processImage(InputImage inputImage) async {
    if (!_canProcess) return;
    if (_isBusy) return;
    _isBusy = true;
    setState(() {
      _text = '';
    });

    // â‘¢processImageé–¢æ•°ã«ç”»åƒã‚’æ¸¡ã™
    final faces = await _faceDetector.processImage(inputImage);
    // â‘£æ¤œå‡ºã•ã‚ŒãŸé¡”ã®æ•°ã‚’å–å¾—
    String text = 'æ¤œå‡ºã•ã‚ŒãŸé¡”ã®æ•°: ${faces.length}\n\n';

    // â‘¤æ¤œå‡ºã•ã‚ŒãŸé¡”ã®ç¬‘é¡”åº¦(smilingProbability)ã‚’å–å¾—
    for (final face in faces) {
      text +=
          'smilingProbabilityã®å€¤: ${(face.smilingProbability! * 100).floor()}%\n\n';
      _text = text;
    }
    _isBusy = false;
    if (mounted) {
      setState(() {});
    }
  }
}
```
:::
face_detector_view.dartã§ã¯ã€FaceDetectorã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«processImageé–¢æ•°ã«æ¤œå‡ºã—ãŸã„ç”»åƒã‚’æ¸¡ã™ã“ã¨ã§é¡”æ¤œå‡ºã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
```dart
// â‘¢processImageé–¢æ•°ã«ç”»åƒã‚’æ¸¡ã™
final faces = await _faceDetector.processImage(inputImage);
```
æ¤œå‡ºã•ã‚ŒãŸé¡”ã‚’facesã¨ã—ã¦å—ã‘å–ã‚Šã€ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ©ç”¨ã§ãã‚‹ã€‚
```dart
// â‘£æ¤œå‡ºã•ã‚ŒãŸé¡”ã®æ•°ã‚’å–å¾—
String text = 'æ¤œå‡ºã•ã‚ŒãŸé¡”ã®æ•°: ${faces.length}\n\n';
```

```dart
// â‘¤æ¤œå‡ºã•ã‚ŒãŸé¡”ã®ç¬‘é¡”åº¦(smilingProbability)ã‚’å–å¾—
for (final face in faces) {
      text +=
          'smilingProbabilityã®å€¤: ${(face.smilingProbability! * 100).floor()}%\n\n';
      _text = text;
    }
```
ä»Šå›ã¯ã€ç¬‘é¡”åº¦(smilingProbability)ã‚’åˆ©ç”¨ã—ãŸãŒã€ä»–ã«ã‚‚é¡”ã®å‘ãã‚„è¼ªéƒ­ãªã©ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒåˆ©ç”¨ã§ãã‚‹ã€‚

**5. camera_view.dartã®å®Ÿè£…**
:::details camera_view.dart
```dart:camera_view.dart
import 'dart:io';
import 'package:flutter/material.dart';
import 'package:google_mlkit_commons/google_mlkit_commons.dart';
import 'package:image_picker/image_picker.dart';

enum ScreenMode { liveFeed, gallery }

class CameraView extends StatefulWidget {
  const CameraView({
    Key? key,
    this.text,
    required this.onImage,
  }) : super(key: key);

  final String? text;
  final Function(InputImage inputImage) onImage;

  @override
  State<CameraView> createState() => _CameraViewState();
}

class _CameraViewState extends State<CameraView> {
  File? _image;
  String? _path;
  ImagePicker? _imagePicker;

  @override
  Widget build(BuildContext context) {
    _imagePicker = ImagePicker();
    return _galleryBody();
  }

  Widget _galleryBody() {
    return ListView(shrinkWrap: true, children: [
      // â‘ é¸æŠã•ã‚ŒãŸç”»åƒã‚’è¡¨ç¤º
      _image != null
          ? SizedBox(height: 400, width: 400, child: Image.file(_image!))

          // â‘¡ç”»åƒæœªé¸æŠã®å ´åˆã¯ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
          : const Padding(
              padding: EdgeInsets.symmetric(vertical: 80),
              child: Center(child: Text('ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„')),
            ),

      Padding(
        padding: const EdgeInsets.symmetric(horizontal: 16),
        child: ElevatedButton(
          child: const Text('From Gallery'),
          onPressed: () => _getImage(ImageSource.gallery),
        ),
      ),
      if (_image != null)
        Padding(
          padding: const EdgeInsets.all(16.0),

          // â‘¢æ¤œå‡ºã—ãŸé¡”ã®æ•°ã¨ç¬‘é¡”åº¦ã‚’è¡¨ç¤º
          child: Text('${_path == null ? '' : ''}\n\n${widget.text ?? ''}'),
        ),
    ]);
  }

  // â‘£å†™çœŸãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ç”»åƒã‚’å–å¾—ã™ã‚‹ãŸã‚ã®é–¢æ•°
  Future _getImage(ImageSource source) async {
    setState(() {
      _image = null;
      _path = null;
    });
    final pickedFile = await _imagePicker?.pickImage(source: source);
    if (pickedFile != null) {
      _processPickedFile(pickedFile);
    }
    setState(() {});
  }

  Future _processPickedFile(XFile? pickedFile) async {
    final path = pickedFile?.path;
    if (path == null) {
      return;
    }
    setState(() {
      _image = File(path);
    });
    _path = path;
    final inputImage = InputImage.fromFilePath(path);
    widget.onImage(inputImage);
  }
}
```
:::
camera_view.dartã§ã¯ã€æ¤œå‡ºã•ã‚ŒãŸå€¤ã®è¡¨ç¤ºãªã©UIã‚’å®Ÿè£…ã™ã‚‹ã€‚


# å‹•ä½œç¢ºèª
1. ã‚¢ãƒ—ãƒªèµ·å‹•
![](/images/mlkit_1.png =300x)

2. å†™çœŸã‚’é¸æŠ
![](/images/mlkit_2.png =300x)

# å®Ÿè£…ã‚³ãƒ¼ãƒ‰
ä»Šå›å®Ÿè£…ã—ãŸã‚³ãƒ¼ãƒ‰å…¨æ–‡
:::details main.dart
```dart:main.dart
import 'package:flutter/material.dart';
import 'face_detector_view.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      debugShowCheckedModeBanner: false,
      home: Home(),
    );
  }
}

class Home extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
        appBar: AppBar(
          title: const Text('Face Detector App'),
        ),
        // â‘ FaceDetectorViewã‚’ã‚»ãƒƒãƒˆ
        body: FaceDetectorView());
  }
}
```
:::

:::details face_detector_view.dart
```dart:face_detector_view.dart
import 'package:flutter/material.dart';
import 'package:google_mlkit_face_detection/google_mlkit_face_detection.dart';
import 'camera_view.dart';

class FaceDetectorView extends StatefulWidget {
  @override
  State<FaceDetectorView> createState() => _FaceDetectorViewState();
}

class _FaceDetectorViewState extends State<FaceDetectorView> {
  // â‘ FaceDetectorã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
  final FaceDetector _faceDetector = FaceDetector(
    options: FaceDetectorOptions(
      enableContours: true,
      enableClassification: true,
    ),
  );
  bool _canProcess = true;
  bool _isBusy = false;
  String? _text;

  @override
  void dispose() {
    _canProcess = false;
    _faceDetector.close();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return CameraView(
      text: _text,
      onImage: (inputImage) {
        processImage(inputImage);
      },
    );
  }

  // â‘¡é¡”æ¤œå‡ºå‡¦ç†ã®ãŸã‚ã®é–¢æ•°
  Future<void> processImage(InputImage inputImage) async {
    if (!_canProcess) return;
    if (_isBusy) return;
    _isBusy = true;
    setState(() {
      _text = '';
    });

    // â‘¢processImageé–¢æ•°ã«ç”»åƒã‚’æ¸¡ã™
    final faces = await _faceDetector.processImage(inputImage);
    // â‘£æ¤œå‡ºã•ã‚ŒãŸé¡”ã®æ•°ã‚’å–å¾—
    String text = 'æ¤œå‡ºã•ã‚ŒãŸé¡”ã®æ•°: ${faces.length}\n\n';

    // â‘¤æ¤œå‡ºã•ã‚ŒãŸé¡”ã®ç¬‘é¡”åº¦(smilingProbability)ã‚’å–å¾—
    for (final face in faces) {
      text +=
          'smilingProbabilityã®å€¤: ${(face.smilingProbability! * 100).floor()}%\n\n';
      _text = text;
    }
    _isBusy = false;
    if (mounted) {
      setState(() {});
    }
  }
}
```
:::

:::details camera_view.dart
```dart:camera_view.dart
import 'dart:io';
import 'package:flutter/material.dart';
import 'package:google_mlkit_commons/google_mlkit_commons.dart';
import 'package:image_picker/image_picker.dart';

enum ScreenMode { liveFeed, gallery }

class CameraView extends StatefulWidget {
  const CameraView({
    Key? key,
    this.text,
    required this.onImage,
  }) : super(key: key);

  final String? text;
  final Function(InputImage inputImage) onImage;

  @override
  State<CameraView> createState() => _CameraViewState();
}

class _CameraViewState extends State<CameraView> {
  File? _image;
  String? _path;
  ImagePicker? _imagePicker;

  @override
  Widget build(BuildContext context) {
    _imagePicker = ImagePicker();
    return _galleryBody();
  }

  Widget _galleryBody() {
    return ListView(shrinkWrap: true, children: [
      // â‘ é¸æŠã•ã‚ŒãŸç”»åƒã‚’è¡¨ç¤º
      _image != null
          ? SizedBox(height: 400, width: 400, child: Image.file(_image!))

          // â‘¡ç”»åƒæœªé¸æŠã®å ´åˆã¯ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
          : const Padding(
              padding: EdgeInsets.symmetric(vertical: 80),
              child: Center(child: Text('ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„')),
            ),

      Padding(
        padding: const EdgeInsets.symmetric(horizontal: 16),
        child: ElevatedButton(
          child: const Text('From Gallery'),
          onPressed: () => _getImage(ImageSource.gallery),
        ),
      ),
      if (_image != null)
        Padding(
          padding: const EdgeInsets.all(16.0),

          // â‘¢æ¤œå‡ºã—ãŸé¡”ã®æ•°ã¨ç¬‘é¡”åº¦ã‚’è¡¨ç¤º
          child: Text('${_path == null ? '' : ''}\n\n${widget.text ?? ''}'),
        ),
    ]);
  }

  // â‘£å†™çœŸãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ç”»åƒã‚’å–å¾—ã™ã‚‹ãŸã‚ã®é–¢æ•°
  Future _getImage(ImageSource source) async {
    setState(() {
      _image = null;
      _path = null;
    });
    final pickedFile = await _imagePicker?.pickImage(source: source);
    if (pickedFile != null) {
      _processPickedFile(pickedFile);
    }
    setState(() {});
  }

  Future _processPickedFile(XFile? pickedFile) async {
    final path = pickedFile?.path;
    if (path == null) {
      return;
    }
    setState(() {
      _image = File(path);
    });
    _path = path;
    final inputImage = InputImage.fromFilePath(path);
    widget.onImage(inputImage);
  }
}
```
:::

# ã¾ã¨ã‚
Flutterã§ML Kitã‚’æ‰±ã†ä¸Šã§å¿…è¦ãªåŸºç¤çŸ¥è­˜ã¨å®Ÿè£…ã«é–¢ã—ã¦ç¢ºèªã—ãŸã€‚
ä»Šå›ã®å®Ÿè£…ã§ã¯ã€ML Kitã®å…¨ãƒ¢ãƒ‡ãƒ«ã‚’å«ã‚€[ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª](https://github.com/bharat-biradar/Google-Ml-Kit-plugin/tree/master/packages/google_ml_kit/example)ã®ä¸­ã‹ã‚‰é¡”æ¤œå‡ºã«é–¢é€£ã™ã‚‹éƒ¨åˆ†ã‚’å‚è€ƒã«ã—ã€ãªã‚‹ã¹ãã‚·ãƒ³ãƒ—ãƒ«ã«é¡”æ¤œå‡ºã®æ©Ÿèƒ½ã ã‘ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ãªã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ãŸã€‚
ä»–ã®ãƒ¢ãƒ‡ãƒ«ã«é–¢ã—ã¦ã‚‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã—ã¦ç°¡å˜ã«Flutterã‹ã‚‰åˆ©ç”¨ã§ãã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸã€‚

# å‚è€ƒ
ãƒ»ML Kitå…¬å¼ã‚¬ã‚¤ãƒ‰
https://developers.google.com/ml-kit/guides

ãƒ»Firebase MLå…¬å¼ã‚¬ã‚¤ãƒ‰
https://firebase.google.com/docs/ml?hl=ja

ãƒ»google_ml_kit
https://pub.dev/packages/google_ml_kit

ãƒ»google_mlkit_face_detection
https://pub.dev/packages/google_mlkit_face_detection

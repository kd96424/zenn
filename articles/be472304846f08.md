---
title: "ã€Flutterã€‘FutureBuilderã®æ­£ã—ã„ä½¿ã„æ–¹"
emoji: "ğŸ’»"
type: "tech"
topics: [Flutter,FutureBuilder,Dart]
published: true
---
# èƒŒæ™¯
Flutterå…¬å¼ã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆç´¹ä»‹ã§ã‚ã‚‹ã€Widget of the Weekã«[FutureBuilder(Take 2)](https://www.youtube.com/watch?v=zEdw_1B7JHY&list=PLjxrf2q8roU23XGwz3Km7sQZFTdB996iG&index=1)ãŒæŠ•ç¨¿ã•ã‚ŒãŸã€‚(2022/11/18)
ã“ã¡ã‚‰ã®å‹•ç”»ã§ã¯ã€éå»ã«æŠ•ç¨¿ã•ã‚ŒãŸFutureBuilderã«é–¢ã™ã‚‹å®Ÿè£…æ–¹æ³•ãŒè¨‚æ­£ã•ã‚Œã¦ã„ã‚‹ã€‚
å…·ä½“çš„ã«ã¯ã€**FutureBuilderå†…ã§Futureã‚’ç”Ÿæˆã™ã‚‹å®Ÿè£…æ–¹æ³•ã«é–¢ã—ã¦ã€FutureBuilderã®å¤–ã«å‡ºã™**ã‚ˆã†ã«è¨‚æ­£ã•ã‚Œã¦ã„ã‚‹ã€‚
æœ¬è¨˜äº‹ã§ã¯ã€ã“ã®å®Ÿè£…æ–¹æ³•ã®é•ã„ãŒå‡¦ç†ã«ã©ã†å½±éŸ¿ã™ã‚‹ã®ã‹ã‚’ç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ç¢ºèªã™ã‚‹ã€‚

# é–“é•ã£ãŸå®Ÿè£…æ–¹æ³•
FutureBuilderå†…ã§Futureã‚’ç”Ÿæˆã™ã‚‹ã€‚
```dart
FutureBuilder(
    future : http.get('http://awesome.data'),
    ãƒ»ãƒ»ãƒ»
)
```

## å•é¡Œç‚¹
FutureBuilderå†…ã§Futureã‚’ç”Ÿæˆã™ã‚‹ã¨ã€è¦ªWidgetãŒãƒªãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ãŸã³ã«éåŒæœŸå‡¦ç†ãŒèµ°ã£ã¦ã—ã¾ã†ã€‚

# æ­£ã—ã„å®Ÿè£…æ–¹æ³•
initStateã‚„ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ¡ã‚½ãƒƒãƒ‰å†…ãªã©FutureBuilderã®å¤–ã§Futureã‚’ã‚ã‚‰ã‹ã˜ã‚ä¿æŒã—ã¦ãŠãã€ãã‚Œã‚’FutureBuilderã«æ¸¡ã™ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹ã€‚
```dart
Future<MyData> _data;

initState(){
    _data = http.get('http://awesome.data');
}

FutureBuilder(
    future : _data,
    ãƒ»ãƒ»ãƒ»
)
```

# å‹•ä½œç¢ºèª
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã€å®Ÿéš›ã«ãã‚Œãã‚Œã®å‹•ä½œã®é•ã„ã‚’ç¢ºèªã™ã‚‹ã€‚

## ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®æ¦‚è¦
Flutterã®ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒª(ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒª)ã«éåŒæœŸå‡¦ç†ã‚’è¿½åŠ ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ä½œæˆã€‚(ã‚³ãƒ¼ãƒ‰å…¨æ–‡ã¯[ã“ã¡ã‚‰](#å®Ÿè£…ã‚³ãƒ¼ãƒ‰))
éåŒæœŸå‡¦ç†ã§ã¯ã€1ç§’å¾Œã«æ–‡å­—åˆ—ã‚’å–å¾—ã™ã‚‹ã€‚
```dart
Future.delayed(const Duration(seconds: 1), () => 'å®Œäº†')
```
FutureBuilderã‚’åˆ©ç”¨ã—ã¦éåŒæœŸã§å–å¾—ã—ãŸæ–‡å­—åˆ—ã‚’ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ã€‚
![](/images/2_futurebuilder.png =300x)

éåŒæœŸå‡¦ç†ã®é–“ã¯ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹ã€‚
![](/images/1_futurebuilder.png =300x)

## é–“é•ã£ãŸå®Ÿè£…æ–¹æ³•ã®å ´åˆ
é‡è¦ãªã‚³ãƒ¼ãƒ‰ä»¥å¤–ã¯çœç•¥ã€‚
```dart:main.dart
    body: FutureBuilder(
        // â‘ FutureBuilderå†…ã§Futureã‚’ç”Ÿæˆ
        future: Future.delayed(const Duration(seconds: 1), () => 'å®Œäº†'),
        builder: ---çœç•¥---
```
### å®Ÿè¡Œ
![](/images/3_futurebuilder.gif)
ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã—ã€ãƒªãƒ“ãƒ«ãƒ‰ãŒèµ°ã‚‹ãŸã³ã«éåŒæœŸå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã€‚

## æ­£ã—ã„å®Ÿè£…æ–¹æ³•ã®å ´åˆ
é‡è¦ãªã‚³ãƒ¼ãƒ‰ä»¥å¤–ã¯çœç•¥ã€‚
```dart:main.dart
class _MyHomePageState extends State<MyHomePage> {
    // â‘ Futureã‚’å®šç¾©
    Future<dynamic>? _data;

    @override
    initState() {
        super.initState();
        // â‘¡Futureã‚’ã‚ã‚‰ã‹ã˜ã‚_dataã«ä¿æŒã—ã¦ãŠã
        _data = Future.delayed(const Duration(seconds: 1), () => 'å®Œäº†');
    }

    @override
    Widget build(BuildContext context) {
        return Scaffold(
            appBar : ---çœç•¥---
            body: FutureBuilder(
                // â‘¢FutureBuilderã«_dataã‚’æ¸¡ã™
                future: _data,
                builder: ---çœç•¥---
    }
}
```
### å®Ÿè¡Œ
![](/images/4_futurebuilder.gif)
åˆå›ãƒ“ãƒ«ãƒ‰æ™‚ã®ã¿éåŒæœŸå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã—ã€ãƒªãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã‚‚éåŒæœŸå‡¦ç†ã¯å®Ÿè¡Œã•ã‚Œãªã„ã€‚

# å®Ÿè£…ã‚³ãƒ¼ãƒ‰
ä»Šå›å®Ÿè£…ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã‚µãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰å…¨æ–‡
```dart:main.dart
import 'package:flutter/material.dart';

void main() => runApp(MyApp());

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      debugShowCheckedModeBanner: false,
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: const MyHomePage(title: 'Flutter Demo Home Page'),
    );
  }
}

class MyHomePage extends StatefulWidget {
  final String title;
  const MyHomePage({
    Key? key,
    required this.title,
  }) : super(key: key);
  @override
  State<MyHomePage> createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage> {
  // â‘ Futureã‚’å®šç¾©
  Future<dynamic>? _data;

  int _counter = 0;
  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  initState() {
    super.initState();
    // â‘¡Futureã‚’ã‚ã‚‰ã‹ã˜ã‚_dataã«ä¿æŒã—ã¦ãŠã
    _data = Future.delayed(const Duration(seconds: 1), () => 'å®Œäº†');
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(widget.title),
      ),
      body: FutureBuilder(
        // â‘¢FutureBuilderã«_dataã‚’æ¸¡ã™
        future: _data,
        builder: (BuildContext context, AsyncSnapshot<dynamic> snapshot) {
          if (snapshot.connectionState == ConnectionState.done) {
            if (snapshot.hasData) {
              String data = snapshot.data;
              return contents(data);
            } else {
              String data = 'ã‚¨ãƒ©ãƒ¼';
              return contents(data);
            }
          } else if (snapshot.connectionState == ConnectionState.waiting) {
            return Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const CircularProgressIndicator(),
                  Text('$_counter', style: const TextStyle(fontSize: 24))
                ],
              ),
            );
          } else {
            String data = 'ã‚¨ãƒ©ãƒ¼';
            return contents(data);
          }
        },
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: 'Increment',
        child: const Icon(Icons.add),
      ),
    );
  }

  Center contents(String data) {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Text(data, style: const TextStyle(fontSize: 24)),
          Text('$_counter', style: const TextStyle(fontSize: 24))
        ],
      ),
    );
  }
}
```

# ã¾ã¨ã‚
FutureBuilderã®æ­£ã—ã„å®Ÿè£…æ–¹æ³•ã«é–¢ã—ã¦ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ç”¨ã„ã¦ç¢ºèªã—ãŸã€‚å®Ÿè£…ã®é•ã„ã«ã‚ˆã‚Šã€æ„å›³ã—ãªã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§éåŒæœŸå‡¦ç†ãŒèµ°ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã§ããŸã€‚

# å‚è€ƒ
- FutureBuilder(Widget of the Week)
https://www.youtube.com/watch?v=zEdw_1B7JHY&list=PLjxrf2q8roU23XGwz3Km7sQZFTdB996iG&index=1

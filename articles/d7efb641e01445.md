---
title: "ã€Flutterã€‘Supabase Storageã®ä½¿ã„æ–¹"
emoji: "ğŸ’»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Flutter", "supabase","Storage"]
published: true
---
# è¨˜äº‹ã®æ¦‚è¦
æœ¬è¨˜äº‹ã§ã¯ã€Flutterã‚¢ãƒ—ãƒªã‹ã‚‰Supabaseã®**Storage**ã‚’æ‰±ã†ãŸã‚ã«å¿…è¦ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã¨ã€å®Ÿéš›ã«ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’Storageä¸Šã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒ—ãƒªã«è¡¨ç¤ºã€ãã—ã¦Storageä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹éš›ã®å®Ÿè£…æ–¹æ³•ã«é–¢ã—ã¦è§£èª¬ã™ã‚‹ã€‚

# å‰æçŸ¥è­˜
## Supabaseã¨ã¯
Firebaseã®ã‚ˆã†ãªBaaS(Backend As A Service)ã®ä¸€ã¤ã§ã‚ã‚Šã€è¤‡æ•°ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã€‚
Supabaseã§ã¯DBã«**PostgreSQL**ã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã€PostgreSQLã®æ—¢å­˜æ©Ÿèƒ½ã‚„ã€SQLã®çŸ¥è­˜ã€RDBã®çŸ¥è­˜ã‚’ãã®ã¾ã¾æ´»ã‹ã›ã‚‹ãŸã‚å­¦ç¿’ã‚³ã‚¹ãƒˆãŒä½ãã€ä»Šæ³¨ç›®ã•ã‚Œã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã¨ãªã£ã¦ã„ã‚‹ã€‚

## Storageã¨ã¯
ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ç”»åƒã‚’ç®¡ç†ã§ãã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ã€‚
Supabaseã§ã¯ã€è£å´ã«AWSã®S3ã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã€S3ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã‚»ã‚­ãƒ¥ã‚¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ä»•çµ„ã¿ã‚’æä¾›ã—ã¦ã„ã‚‹ã€‚

# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
## Supabaseå´ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
**1. Supabaseã«ãƒ­ã‚°ã‚¤ãƒ³**
[Supabase](https://app.supabase.com/sign-in)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ç®¡ç†ç”»é¢ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã€‚
Supabaseã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãªã„å ´åˆã¯æ–°è¦ä½œæˆã™ã‚‹ã€‚

**2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ**
ç®¡ç†ç”»é¢ã«ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€All projects > New projectã‹ã‚‰æ–°ã—ããƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

**3. ãƒã‚±ãƒƒãƒˆã®ä½œæˆ**
Storage > New bucketã‹ã‚‰æ–°ã—ããƒã‚±ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ã€‚
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯privateãªãƒã‚±ãƒƒãƒˆãŒä½œæˆã•ã‚Œã‚‹ã€‚
Public bucketã‚’ã‚ªãƒ³ã«ã™ã‚‹ã“ã¨ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚„Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ãªã—ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹publicãªãƒã‚±ãƒƒãƒˆãŒä½œæˆã§ãã‚‹ã€‚
![](/images/storage_3.png =800x)

**4. ãƒãƒªã‚·ãƒ¼ã®ä½œæˆ**
Supabaseã®Storageã¯PostgresDBã¨çµ±åˆã•ã‚Œã¦ãŠã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«å¯¾ã—ã¦ã€**RLS(Row Level Security)ãƒãƒªã‚·ãƒ¼**ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
publicãªãƒã‚±ãƒƒãƒˆã§ã¯ã€ä½•ã‚‚ãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ã¦ã„ãªã„å ´åˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚„å‰Šé™¤ç­‰ã®æ“ä½œãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨ã¦æ‹’å¦ã•ã‚Œã‚‹ã®ã§å¿…ãšè¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
ä½œæˆã—ãŸãƒã‚±ãƒƒãƒˆã‚’é¸æŠå¾Œã€New policyã‹ã‚‰ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã™ã‚‹ã€‚
![](/images/storage_4.png =800x)

ãƒãƒªã‚·ãƒ¼ã¯ç°¡å˜ã«è¨­å®šã§ãã‚‹ã‚ˆã†æ—¢ã«Supabaseã§ã„ãã¤ã‹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€‚
ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€ŒGet started quicklyã€ã€ã‚«ã‚¹ã‚¿ãƒ ã§ç‹¬è‡ªã®ãƒãƒªã‚·ãƒ¼ã‚’é©ç”¨ã—ãŸã„å ´åˆã¯ã€ŒFor full Customizationã€ã‚’é¸æŠã™ã‚‹ã€‚
![](/images/storage_5.png =800x)

ä¾‹ã¨ã—ã¦ã€ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å†…ã€ŒAllow access to JPG images in a public folder to anonymous usersã€ã‚’é¸æŠã—ãŸå ´åˆã€Storageã§æ‰±ãˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’JPGã®ã¿ã«æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
![](/images/storage_6.png =800x)

ãƒãƒªã‚·ãƒ¼ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®å„æ“ä½œã”ã¨ã«è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
SELECTã€INSERTã€UPDATEã€DELETEã®ä¸­ã‹ã‚‰ãƒãƒªã‚·ãƒ¼ã‚’é©ç”¨ã—ãŸã„ã‚‚ã®ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã€‚
![](/images/storage_7.png =800x)

## Flutterå´ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
**1. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```dart:pubspec.yaml
dependencies:
  supabase_flutter: ^1.4.0
```

**2. Supabaseã®åˆæœŸåŒ–ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½œæˆ**
åˆæœŸåŒ–æ™‚ã«å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯Supabaseã®ç®¡ç†ç”»é¢>Settings>APIã‹ã‚‰äº‹å‰ã«ç¢ºèªã™ã‚‹ã€‚
![](/images/storage_8.png =800x)
```dart:main.dart
import 'package:supabase_flutter/supabase_flutter.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Supabase.initialize(
    // Project URLã®å€¤
    url: SUPABASE_URL,
    // Project API keysã®anon keyã®å€¤
    anonKey: SUPABASE_ANON_KEY,
  );
  runApp(MyApp());
}
// Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½œæˆ(å¤‰æ•°ã«æ ¼ç´ã—ã€ã‚¢ãƒ—ãƒªå†…ã‹ã‚‰å‘¼ã³å‡ºã—ã¦åˆ©ç”¨ã™ã‚‹)
final supabase = Supabase.instance.client;
```

# å®Ÿè£…æ–¹æ³•
## Storageã¸ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
upload()é–¢æ•°ã‚’åˆ©ç”¨ã—ã¦Storageã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
```dart:
// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«
File file;
// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã®Path
String path = 'folder/test.jpg';
// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰(Bucketå=sample)
await supabase.storage.from('sample').upload(path, file);
```
ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œ(sample/folder/test.jpg)
![](/images/storage_9.png =800x)

## Storageä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒ—ãƒªã«è¡¨ç¤º
Storageã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹éš›ã¯ã€ãã®ç”»åƒã®URLã‚’åˆ©ç”¨ã—ã¦è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
publicãªãƒã‚±ãƒƒãƒˆã®å ´åˆ
  â†’getPublicUrl()é–¢æ•°ã‚’åˆ©ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’å–å¾—ã™ã‚‹ã€‚
privateãªãƒã‚±ãƒƒãƒˆã®å ´åˆ
  â†’createSignedUrl()é–¢æ•°ã‚’åˆ©ç”¨ã—ã¦æœ‰åŠ¹æœŸé™ã®ã‚ã‚‹URLã‚’å–å¾—ã™ã‚‹ã€‚

```dart:
// URLã‚’æ ¼ç´ã™ã‚‹å¤‰æ•°
final String? fileUrl;
// ãƒ•ã‚¡ã‚¤ãƒ«ã®æ ¼ç´Path
String path = 'folder/test.jpg';

// publicãªãƒã‚±ãƒƒãƒˆã®å ´åˆ
// URLã®å–å¾—
fileUrl = await supabase.storage.from('sample').getPublicUrl(path);

// privateãªãƒã‚±ãƒƒãƒˆã®å ´åˆ
// URLã®å–å¾—(ç¬¬äºŒå¼•æ•°ã¯æœ‰åŠ¹æœŸé™ã®ç§’æ•°)
fileUrl = await supabase.storage.from('sample').â†’createSignedUrl(path, 60);
```
å–å¾—ã—ãŸURLã‚’Image.networkã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«æ¸¡ã™ã“ã¨ã§ç”»åƒã‚’è¡¨ç¤ºã§ãã‚‹ã€‚
```dart:
// ç”»åƒã‚’è¡¨ç¤º
Center(
    child: Image.network(fileUrl);
)
```
URLã‚’å–å¾—ã™ã‚Œã°ç›´æ¥Storageä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«å†…ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ãŸã‚Šã™ã‚‹å¿…è¦ãŒãªã„ã€‚

## Storageä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
remove()é–¢æ•°ã‚’åˆ©ç”¨ã—ã¦Storageä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
å¼•æ•°ã«ã¯å‰Šé™¤ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã®pathã‚’Listå½¢å¼ã§æ¸¡ã™å¿…è¦ãŒã‚ã‚‹ã€‚
```dart:
// å‰Šé™¤ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã®pathã®List
List<String> paths = ['folder/test.jpg'];
// å‰Šé™¤
await supabase.storage.from('sample').remove(paths);
```

# å‚è€ƒ
ãƒ»[Supabase å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://supabase.com/docs/guides/storage)
ãƒ»[supabase_flutter](https://pub.dev/packages/supabase_flutter)
ãƒ»[Supabaseã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€è¡¨ç¤ºã™ã‚‹](https://qiita.com/dshukertjr/items/05437bb88bc7ae8583b8)